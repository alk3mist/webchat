(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{22:function(e,t,n){e.exports=n.p+"static/media/logo.14ec0f32.svg"},25:function(e,t,n){e.exports=n(57)},31:function(e,t,n){},36:function(e,t,n){},37:function(e,t,n){},57:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(21),o=n.n(s),c=(n(31),n(11)),i=n(1),u=n.n(i),l=n(8),m=n(3),p=n(4),h=n(6),d=n(5),f=n(10),g=n(7),b=n(9),v=n.n(b);var O=v.a.shape({id:v.a.number.isRequired,username:v.a.string.isRequired}),w=(v.a.shape({id:v.a.string.isRequired,text:v.a.string.isRequired,created_at:v.a.instanceOf(Date).isRequired,author:O.isRequired}),function(e){function t(e){var n;return Object(m.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).scrollToBottom=function(){n.bottomRef.current.scrollIntoView({behavior:"smooth"})},n.renderMessages=function(){var e=n.props.username;return n.props.messages.map(function(t){var n=t.id,a=t.text,s=t.author,o=t.created_at;return r.a.createElement("li",{key:n,className:"message ".concat(s.username===e?"float-right":"float-left")},s.username!==e&&r.a.createElement("h4",null,s.username),r.a.createElement("pre",null,a),r.a.createElement("p",{className:"float-right"},r.a.createElement("small",null,o.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}))))})},n.bottomRef=r.a.createRef(),n}return Object(g.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){this.scrollToBottom()}},{key:"componentDidUpdate",value:function(e,t,n){var a=e.messages,r=this.props.messages;if(a.length){if(r.length){var s=a[a.length-1],o=r[r.length-1];s.created_at<o.created_at&&this.scrollToBottom()}}else this.scrollToBottom()}},{key:"render",value:function(){var e=this.props.canLoadMore;return r.a.createElement("ul",{className:"list-message"},e&&r.a.createElement("li",{className:"center w-50 mb-1"},r.a.createElement("button",{className:"button w-100",onClick:this.props.onLoadMore},"Load more messages")),this.renderMessages(),r.a.createElement("li",{ref:this.bottomRef}))}}]),t}(r.a.Component)),j=function(e){function t(e){var n;return Object(m.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).handleInputChange=function(e){var t=e.target.value;n.setState({inputValue:t})},n.handleInputKeyUp=function(e){var t=e.target.value;if(27===e.keyCode)n.setState({inputValue:""});else if(13===e.keyCode){if(!e.ctrlKey)return e.preventDefault(),n.submit(),!1;n.setState({inputValue:t+"\n"})}},n.submit=function(e){"undefined"!==typeof e&&e.preventDefault();var t=n.state.inputValue;t.trim().length&&(n.props.onSubmit(t),n.setState({inputValue:""}))},n.state={inputValue:""},n.inputRef=r.a.createRef(),n}return Object(g.a)(t,e),Object(p.a)(t,[{key:"componentDidUpdate",value:function(e,t,n){this.state.inputValue.endsWith("\n")&&this.inputRef.current.scrollTo(0,this.inputRef.current.scrollHeight)}},{key:"render",value:function(){return r.a.createElement("form",{className:"message-form",onSubmit:this.submit},r.a.createElement("textarea",{ref:this.inputRef,placeholder:"Type a message. Press Enter to send a message, Ctrl+Enter to add a line.",value:this.state.inputValue,onChange:this.handleInputChange,onKeyUp:this.handleInputKeyUp,autoFocus:!0,maxLength:300}),r.a.createElement("button",{type:"submit",className:"button"},r.a.createElement("code",null,"\u25ba")))}}]),t}(r.a.Component),E=(n(36),function(e){function t(){return Object(m.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this.props,t=e.username,n=e.messages,a=e.canLoadMore,s=e.error;return r.a.createElement("div",{className:"chat"},r.a.createElement("div",{className:"header"},r.a.createElement("h3",null,"WebChat"),r.a.createElement("div",{className:"float-right"},t," ",r.a.createElement("span",{className:"button button-sm",onClick:this.props.onLogout},"\u2715"))),r.a.createElement("hr",null),!!s&&r.a.createElement("div",{className:"error-message"},s.toString()),r.a.createElement(w,{messages:n,username:t,canLoadMore:a,onLoadMore:this.props.onLoadMore}),r.a.createElement(j,{onSubmit:this.props.onSendMessage}))}}]),t}(r.a.Component));E.defaultProps={messages:[]};var y=E,C=function(e){function t(e){var n;return Object(m.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).handleSubmit=function(e){e.preventDefault(),n.props.onSubmit(n.state.username)},n.handleInputChange=function(e){n.setState({username:e.target.value})},n.state={username:""},n}return Object(g.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return r.a.createElement("form",{onSubmit:this.handleSubmit},r.a.createElement("input",{type:"text",placeholder:"Enter your name",value:this.state.username,onChange:this.handleInputChange}),r.a.createElement("button",{type:"submit",className:"button"},"Login"))}}]),t}(r.a.Component),S=n(22),k=n.n(S),x=(n(37),n(14)),R=n(13),L=n(23),M=n.n(L),N=n(24),U=n.n(N),_="True"===Object({NODE_ENV:"production",PUBLIC_URL:""}).REACT_APP_DEBUG,D=M.a.create({baseURL:J({pathname:"/api/"}),headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"},credentials:"same-origin"});function I(e){return Object(l.a)(u.a.mark(function t(){var n,a,r=arguments;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.apply(this,r);case 3:return n=t.sent,t.abrupt("return",n.data);case 7:throw t.prev=7,t.t0=t.catch(0),(a=t.t0.response)&&/json/i.test(a.headers["content-type"])&&(t.t0.data=a.data),t.t0;case 12:case"end":return t.stop()}},t,this,[[0,7]])}))}var P=function(e,t){var n=t.filters,a=void 0===n?{}:n,r=t.search,s=void 0===r?null:r,o=Object(R.a)(t,["filters","search"]);return function(e,t){return I(D.get)(e,{params:t})}(e,Object(x.a)({},a,o,{search:s}))},T=function(e){return I(D.get)(e)},V=function(){var e=Object(l.a)(u.a.mark(function e(t){var n;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P("/messages/",t);case 2:return(n=e.sent).results=n.results.map(q),e.abrupt("return",n);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),B=function(){var e=Object(l.a)(u.a.mark(function e(t){var n;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T(t);case 2:return(n=e.sent).results=n.results.map(q),e.abrupt("return",n);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();function q(e){var t=e.created_at,n=Object(R.a)(e,["created_at"]);return Object(x.a)({created_at:new Date(t)},n)}function A(e){var t=e.onOpen,n=void 0===t?console.log:t,a=e.onClose,r=void 0===a?console.log:a,s=e.onMessage,o=void 0===s?console.log:s,c=e.onError,i=void 0===c?console.log:c,u=J({protocol:"https:"===window.location.protocol?"wss://":"ws://",pathname:"/ws/chat/"}),l=new U.a(u,null,{debug:_});return l.onopen=n,l.onclose=r,l.onerror=i,l.onmessage=function(e){var t=JSON.parse(e.data);o(q(t.payload))},l}function J(e){var t=e.protocol,n=void 0===t?window.location.protocol:t,a=e.hostname,r=void 0===a?window.location.hostname:a,s=e.port,o=void 0===s?_?"8000":window.location.port:s,c=e.pathname,i=void 0===c?"/":c,u=o.length?":":"";return"".concat(n,"//").concat(r).concat(u).concat(o).concat(i)}var K=function(e){function t(e){var n;return Object(m.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).login=function(){var e=Object(l.a)(u.a.mark(function e(t){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.setState({username:t});case 2:t.trim()&&(n.ws=A({onMessage:n.handleMessage.bind(Object(f.a)(n)),onError:n.handleError.bind(Object(f.a)(n)),onClose:n.handleClose.bind(Object(f.a)(n)),onOpen:n.handleConnect.bind(Object(f.a)(n))}));case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.handleConnect=Object(l.a)(u.a.mark(function e(){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.setState({connected:!0,error:null});case 2:return e.next=4,n.fetchMessages();case 4:case"end":return e.stop()}},e)})),n.handleMessage=function(e){n.setState({messages:[].concat(Object(c.a)(n.state.messages),[e])})},n.handleError=function(){n.setState({error:"Connection error. Trying reconnect..."})},n.handleClose=function(){n.setState({connected:!1,messages:[],previousPageURL:null})},n.fetchMessages=Object(l.a)(u.a.mark(function e(){var t,a;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(t=n.state.previousPageURL)){e.next=7;break}return e.next=4,V({page_size:50,filters:{created_before:(new Date).toISOString()}});case 4:e.t0=e.sent,e.next=10;break;case 7:return e.next=9,B(t);case 9:e.t0=e.sent;case 10:return a=e.t0,e.next=13,n.setState({messages:[].concat(Object(c.a)(a.results.reverse()),Object(c.a)(n.state.messages)),previousPageURL:a.next});case 13:case"end":return e.stop()}},e)})),n.sendMessage=function(){var e=Object(l.a)(u.a.mark(function e(t){var a,r;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{a=n.state.username,r=JSON.stringify({username:a,text:t}),n.ws.send(r)}catch(s){console.log(s)}case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.logout=function(){n.ws.close(),n.setState({username:""})},n.state={previousPageURL:null,connected:!1,messages:[],username:null},n}return Object(g.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this.state,t=e.username,n=e.messages,a=e.previousPageURL,s=e.connected,o=e.error;return r.a.createElement("div",{className:"app"},r.a.createElement("img",{src:k.a,alt:"logo",className:"logo-background ".concat(s?"logo-spin":"")}),r.a.createElement("div",{className:"container"},t?r.a.createElement(y,{username:t,messages:n,onSendMessage:this.sendMessage,canLoadMore:null!=a,onLoadMore:this.fetchMessages,onLogout:this.logout,error:o}):r.a.createElement(C,{onSubmit:this.login})))}}]),t}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(K,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[25,1,2]]]);
//# sourceMappingURL=main.1dc33d0f.chunk.js.map